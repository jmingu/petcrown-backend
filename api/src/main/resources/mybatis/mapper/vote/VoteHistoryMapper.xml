<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.api.vote.mapper.VoteHistoryMapper">

    <!-- 투표 기록 저장 -->
    <insert id="insertVoteHistory" parameterType="kr.co.common.entity.vote.VoteHistoryEntity">
        INSERT INTO vote_history (
            user_id,
            vote_id,
            history_date,
            email,
            create_date,
            vote_cycle
        ) VALUES (
            #{userId},
            #{voteId},
            #{historyDate},
            #{email},
            #{createDate},
            CAST(#{voteCycle} AS vote_cycle_type)
        )
    </insert>

    <!-- 오늘 날짜에 특정 사용자가 특정 투표에 참여했는지 확인 (회원) -->
    <select id="countTodayVoteByUser" resultType="int">
        SELECT COUNT(*)
        FROM vote_history
        WHERE user_id = #{userId}
        AND vote_id = #{voteId}
        AND history_date = #{historyDate}
        AND vote_cycle = CAST(#{voteCycle} AS vote_cycle_type)
    </select>

    <!-- 오늘 날짜에 특정 이메일이 특정 투표에 참여했는지 확인 (비회원) -->
    <select id="countTodayVoteByEmail" resultType="int">
        SELECT COUNT(*)
        FROM vote_history
        WHERE email = #{email}
          AND vote_id = #{voteId}
          AND history_date = #{historyDate}
          AND vote_cycle = CAST(#{voteCycle} AS vote_cycle_type)
    </select>

</mapper>